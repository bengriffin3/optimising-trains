%% Singapore adjacency matrix

A = [-inf	22	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
22	-inf	9	6	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	9	-inf	-inf	5	-inf	-inf	-inf	34	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	6	-inf	-inf	-inf	7	10	14	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	5	-inf	-inf	15	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	7	15	-inf	-inf	-inf	10	4	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	10	-inf	-inf	-inf	3	-inf	-inf	-inf	2	-inf	-inf	4	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	14	-inf	-inf	3	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	34	-inf	-inf	10	-inf	-inf	-inf	8	-inf	-inf	-inf	-inf	-inf	-inf	-inf	5	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	4	-inf	-inf	8	-inf	5	-inf	3	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	5	-inf	4	2	2	-inf	-inf	-inf	-inf	-inf	-inf	6	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	2	-inf	-inf	-inf	4	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	5	-inf	-inf	-inf	14	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	3	2	-inf	-inf	-inf	-inf	-inf	-inf	10	3	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	2	-inf	-inf	-inf	2	-inf	-inf	-inf	2	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	4	-inf	-inf	-inf	-inf	-inf	-inf	2	-inf	2	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	2	-inf	2	-inf	-inf	2	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	2	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	5	-inf	-inf	-inf	10	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	9	-inf	7	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	3	2	-inf	-inf	-inf	-inf	-inf	-inf	2	-inf	-inf	-inf	8	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	5	-inf	-inf	-inf	2	-inf	-inf	-inf	-inf	2	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	6	-inf	-inf	-inf	-inf	-inf	-inf	-inf	2	2	-inf	-inf	-inf	-inf	10	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	9	-inf	-inf	-inf	-inf	3	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	3	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	14	-inf	-inf	-inf	-inf	-inf	7	-inf	-inf	-inf	-inf	-inf	-inf	2	12	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	8	-inf	10	-inf	-inf	2	-inf	-inf	-inf	9	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	12	-inf	-inf	3	5	7	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	3	-inf	-inf	-inf	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	9	5	-inf	-inf	5	-inf;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	7	-inf	5	-inf	8;
-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	-inf	8	-inf	]
A(isinf(A)) = 0
G = digraph(A)
plot(G)
%%
% Optimisation code
% Test matrix
%testmatrix = [-inf	22	-inf	-inf	-inf;
%-inf -inf 9	6 -inf;
%-inf -inf -inf -inf	5;
%-inf -inf -inf -inf	-inf;
%-inf -inf -inf -inf	-inf]
clc
%testmatrix = [0	22 0 0 0; 0	0 9	6 0; 0 0 0 0 5; 0 0	0 0	0; 0 0 0 0	0]
%testmatrix = [0	22 0 0 0; 
%              22 0 9 6 0; 
%              0 9 0 0 5; 
%              0 6 0 0 0; 
%              0 0 5 0 0]

%testmatrix = [0	22 0 0 0 8; 
%              22 0 9 0 8 0; 
%              0 9 0 5 0 0; 
%              0 6 0 0 8 7; 
%              0 0 5 0 0 7;
%              0 0 0 0 0 0];
testmatrix = A;
half_matrix = triu(testmatrix);
[row,col,v] = find(half_matrix);
connect_vec = [row,col]
cycle = grCycleBasis(connect_vec);
S = size(cycle)
%C = nchoosek(cycle,S(2))
ind = nchoosek(1:S(2), 2)
full_cycles_vec = [cycle]

for k = 1:S(2)
   % disp('begin again')
  %  a = ind(k,1)
  %  b = ind(k,2)
  %  c = cycle(:,ind(k,1))
  %  d = cycle(:,ind(k,2))
full_cycles = cycle(:,ind(k,1)) + cycle(:,ind(k,2))
is_even = ~mod(full_cycles,2);
even_ind = find(is_even);
% Make all even elements equal to 0
full_cycles(even_ind) = 0;
% All the other elements are odd so set htem equal to 1
odd_ind = find(full_cycles);
full_cycles(odd_ind) = 1;
full_cycles_vec = [full_cycles_vec, full_cycles];
end
full_cycles_vec


v = 1:size(testmatrix);
all_edges = nchoosek(v,2);
Reverse_all_edges = flip(all_edges')';




p = size(full_cycles_vec);
for ii = 1:p(2)
cycle_val = full_cycles_vec(:,ii).*v;
total_cycle_length = sum(cycle_val);
end


%%

% Find a cycle
%half_matrix = triu(testmatrix)
%[row,col,v] = find(half_matrix)
%connect_vec = [row,col]
%cycle = grCycleBasis(connect_vec)

testmatrix = A
% Number of stations per train
number_stations = ones(length(testmatrix))
% Number of trains per cycle
number_stations_t = number_stations + number_stations'
% Initialise
testmatrix_update = testmatrix;
eigenvalue_vec = []
stations_vec = []
for i = 1:100
circuits = testmatrix+testmatrix';
% Divide by number of trains
circuit_ptrain = circuits./number_stations_t;
% Find max circuit
[max_num] = max(circuits(:));
% Find and store the value and position of eigenvalue
[eigenvalue] = max(circuit_ptrain(:))
eigenvalue_vec = [eigenvalue_vec; eigenvalue];
[row, col] = find(ismember(circuit_ptrain, max(circuit_ptrain(:))));

% If more than one option for max value, locate the specific critical
% circuit
L = length(row);
if L>1
    vec = [zeros(length(row),1)];
    for ii = 1:length(row)
        vec(ii) = testmatrix_update(row(ii),col(ii));
    end
         [val, idx] = max(vec);
    row = row(idx);
    col = col(idx);
end

% Add a train to the critical circuit; this alters the test matrix and no.
% of stations
testmatrix_update(row,col) = testmatrix_update(row,col)*number_stations(row,col)/(number_stations(row,col)+1);
number_stations(row,col) = number_stations(row,col)+1;
stations = sum(sum(number_stations));
stations_vec = [stations_vec; stations];
number_stations_t = number_stations + number_stations';
end

% Plot adjacency matrix
G2 = digraph(testmatrix)
figure(1)
plot(G2)
figure(2)
plot(eigenvalue_vec,stations_vec)
xlabel('Number of additional stations')
ylabel('Eigenvalue')
%title('xxx')

